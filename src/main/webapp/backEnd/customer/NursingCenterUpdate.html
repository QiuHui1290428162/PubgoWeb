<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="keywords" content="">
	<meta name="author" content="">
	<meta name="robots" content="">
	<meta name="viewport" content="width=device-width,initial-scale=1.0, maximum-scale=1.0,user-scalable=no">
	
	<!-- 此处为页面标题 -->
	<title>护理中心登记</title>
	
	<!-- 引入图标文件 -->
    <link rel="shortcut icon" href="/PubgoWeb/favicon.ico" type="image/x-icon" />
    
    <!-- 引入vant样式文件 -->
	<link
	  rel="stylesheet"
	  href="/PubgoWeb/assets/vant/index.css"
	/>
    
	<link href="/PubgoWeb/static/css/nice-select.css" rel="stylesheet">
	<link href="/PubgoWeb/static/css/owl.carousel.css" rel="stylesheet">
	
	<!-- 自定义css，预加载必须 -->
    <link href="/PubgoWeb/static/css/style.css" rel="stylesheet">
    
    <!-- 引入 Vue , Vant和 axios 的 JS 文件 -->
	<script src="/PubgoWeb/assets/vue/vue.js"></script>
	<script src="/PubgoWeb/assets/vant/vant.min.js"></script>
	<script src="/PubgoWeb/assets/axios/axios.min.js"></script>
    <!-- 引入 自定义 的 JS 文件 -->
    <script src="/PubgoWeb/static/js/customize.js"></script>
    
	<style type="text/css">
		.header-profile img{
			width: 2.5rem;
			height: 2.5rem;
		}
	</style>
	
</head>
<body>

    <!--*******************
     	   预加载程序启动
    ********************-->
    <div id="preloader">
		<div class="lds-ripple">
			<div></div>
			<div></div>
		</div>
    </div>
    <!--*******************
       	 预紧器端
    ********************-->

    <!--**********************************
       	主包装器开始
    ***********************************-->
    <div id="main-wrapper">
    	<van-pull-refresh
		  v-model="isLoading"
		  success-text="刷新成功"
		  @refresh="onRefresh"
		>
   
        <!--**********************************
           	导航标头开始
        ***********************************-->
        <div class="nav-header">
            <a href="/PubgoWeb/index.html" class="brand-logo">
				
				<img src="/PubgoWeb/static/image/logo_index.jpg" alt="首页"  width="48" height="20"/>
				
				<svg class="brand-title" xmlns="http://www.w3.org/2000/svg" width="134.01" height="48.365" viewbox="0 0 134.01 48.365">
				  <g id="Group_38" data-name="Group 38" transform="translate(-133.99 -40.635)">
					<text id="Job_Admin_Dashboard" data-name="Job Admin Dashboard" transform="translate(134 85)" fill="#787878" font-size="12" font-family="Poppins-Light, Poppins" font-weight="300"><tspan x="0" y="0">香港步步高国际集团</tspan></text>
					<text id="Job_Admin_Dashboard" data-name="Job Admin Dashboard" transform="translate(134 63)" fill="#000000" font-size="17" font-family="Poppins-Light, Poppins" font-weight="300"><tspan x="0" y="0">PUBGO步步高鞋</tspan></text>
					
				  </g>
				</svg>
            </a>
            <!-- 侧边栏显示组件 -->
            <div class="nav-control">
                <div class="hamburger">
                    <span class="line"></span><span class="line"></span><span class="line"></span>
                </div>
            </div>
        </div>
        <!--**********************************
         	 导航标头结束
        ***********************************-->
		
		
		
		<!--**********************************
           	页头开始
        ***********************************-->
        <div class="header">
            <div class="header-content">
                <nav class="navbar navbar-expand">
                    <div class="collapse navbar-collapse justify-content-between">
                    	<!-- 设置页面名称 -->
                        <div class="header-left">
							<div class="dashboard_bar">
                               	工作台
                            </div>
                        </div>
                        <ul class="navbar-nav header-right">
							<li class="nav-item dropdown header-profile">
								<a class="nav-link" href="/PubgoWeb/backEnd/customer/NursingCenterManage.html" role="button" >
                                   	 <img alt="护理管理" src="/PubgoWeb/static/image/列表.svg" >
                                </a>
                                <a class="nav-link" href="javascript:void(0);" role="button" data-bs-toggle="dropdown">
                                   	 <img alt="员工管理" src="/PubgoWeb/static/image/员工.svg" >
                                </a>
                                <!-- 弹出框 -->
                                <div class="dropdown-menu dropdown-menu-end">
                                    <a href="/PubgoWeb/index.html" class="dropdown-item ai-icon">
                                        <svg id="icon-user2" xmlns="http://www.w3.org/2000/svg" class="text-primary" width="18" height="18" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>
                                        <span class="ms-2">个人中心 </span>
                                    </a>
                                    <a href="http://www.pubgobbg.com:8282/pda/" class="dropdown-item ai-icon">
                                        <svg id="icon-inbox1" xmlns="http://www.w3.org/2000/svg" class="text-success" width="18" height="18" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg>
                                        <span class="ms-2">OA邮箱 </span>
                                    </a>
                                    <a href="/PubgoWeb/login.html" class="dropdown-item ai-icon">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="text-danger" width="18" height="18" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path><polyline points="16 17 21 12 16 7"></polyline><line x1="21" y1="12" x2="9" y2="12"></line></svg>
                                        <span class="ms-2">退出登录 </span>
                                    </a>
                                </div>
                            </li>
                        </ul>
                    </div>
				</nav>
			</div>
		</div>
        <!--**********************************
           	页头结束
        ***********************************-->

        <!--**********************************
           	侧边栏开始
        ***********************************-->
        <div class="dlabnav">
            <div class="dlabnav-scroll">
				<div class="dropdown header-profile2 ">
					<a class="nav-link " href="javascript:void(0);" role="button" data-bs-toggle="dropdown">
						<div class="header-info2 d-flex align-items-center">
							<img src="/PubgoWeb//static/image/people.svg" width="20"  alt="">
							<div class="d-flex align-items-center sidebar-info">
								<div>
									<span class="font-w400 d-block">ID : {{id}}</span>
									<small class="text-end font-w400">NAME : {{name}}</small>
								</div>	
							</div>
						</div>
					</a>
				</div>
				<ul class="metismenu" id="menu">
					<template v-for="(x, i) in categoryList">
	                    <li><a class="has-arrow " href="javascript:void(0);" aria-expanded="false">
								<i :class="x.image"></i>
								<span class="nav-text">{{x.name}}</span>
							</a>
	                        <ul aria-expanded="false">
	                        	<template v-for="(y, j) in x.categorys">
									<li><a :href="y.path">{{y.name}}</a></li>
								</template>	
							</ul>
	                    </li>
                    </template>	
                </ul>
				<div class="plus-box">
					<p class="fs-14 font-w600 mb-2">Pubgo mobile ERP management system<br></p>
				</div>
				<div class="copyright">
					<p><strong>PUBGO Job Admin</strong> © 2021 All Rights Reserved</p>
					<p class="fs-12"> Made with<span class="heart"></span> by pubgo</p>
				</div>
			</div>
        </div>
        <!--**********************************
           	侧边栏结束
        ***********************************-->
		
		<!--**********************************
            	内容正文开始
        ***********************************-->
		<div class="content-body">
			<van-notice-bar
			  left-icon="volume-o"
			  text="若需要修改图片，请重新上传图片。否则请勿重新上传覆盖修改之前的图片!!!"
			></van-notice-bar>
            <!-- row -->
			<div class="container-fluid">
				<div class="row">
					<div class="col-xl-6">
						<div class="row">
							<!-- 登记表单 -->
							<div class="col-xl-12">
								<div class="card">
									<van-form scroll-to-error @submit="onSubmit">
							   			<van-cell-group inset>
								   			<van-field  
								   			label="洗鞋数量"
								   			@click = "ShoesNumClick"
								   			:rules="[{ validator:numValidator, message: '请填写擦鞋或洗鞋的数量' }]"
								   			>
												<template #input>
													<van-stepper v-model="number" theme="round" button-size="22" min="0" integer/>
												</template>
											</van-field>
								   				
											<van-field  label="图片上传">
												<template #input>
													<van-uploader v-model="fileList" max-count="5"/>
												</template>
											</van-field>
											
											<van-field
												v-model="remark"
												rows="2"
								  				autosize
												label="备注"
												type="textarea"
								  				maxlength="50"
								  				show-word-limit
												placeholder="可输入备注信息"
											></van-field>
										</van-cell-group>
							   			
										<div style="margin: 16px;">
									    	<van-button 
									    	round 
									    	block 
									    	type="danger" 
									    	:loading="btLoading"
									    	loading-text="信息提交中"
									    	native-type="submit" >提交</van-button>
										</div>
									</van-form>
								</div>
							</div>
							
						</div>
					</div>
				</div>	
            </div>
        </div>
        <!--**********************************
            	内容正文 结束
        ***********************************-->
		
        <!--**********************************
            Footer start
        ***********************************-->
        <div class="footer">
            <div class="copyright">
                <p>Copyright &copy; 2022.深圳市步步高鞋商业有限公司 All rights reserved.</p>
            </div>
        </div>
        <!--**********************************
            Footer end
        ***********************************-->


	</div>
    <!--**********************************
       	主包装器结束
    ***********************************-->

    <!--**********************************
        Scripts
    ***********************************-->
    <!-- Required vendors -->
    <script src="/PubgoWeb/static/js/global.min.js"></script>
	<script src="/PubgoWeb/static/js/Chart.bundle.min.js"></script>
	<script src="/PubgoWeb/static/js/jquery.nice-select.min.js"></script>
	
	<script src="/PubgoWeb/static/js/Chart.bundle.min.js"></script>
	
	<!-- Chart piety plugin files -->
    <script src="/PubgoWeb/static/js/jquery.peity.min.js"></script>
	
	<!-- Dashboard 1 -->
	<script src="/PubgoWeb/static/js/dashboard-1.js"></script>
	
	<script src="/PubgoWeb/static/js/owl.carousel.js"></script>
	
    <script src="/PubgoWeb/static/js/custom.min.js"></script>
	<script src="/PubgoWeb/static/js/dlabnav-init.js"></script>
	<script src="/PubgoWeb/static/js/demo.js"></script>
    <script src="/PubgoWeb/static/js/styleSwitcher.js"></script>
    <script src="/PubgoWeb/static/js/customize.js"></script>
    
    <script src="/PubgoWeb/assets/vue/vue.js"></script>
	<script src="/PubgoWeb/assets/vant/vant.min.js"></script>
	<script src="/PubgoWeb/assets/axios/axios.min.js"></script>
	
	<script>			
		const app = Vue.createApp({
			data(){
				return{
					id: "",                  //账号id
					name: "",                //账号名称
					categoryList: [],        //目录列表
					nursingId: '',           //护理id
					number : 0,              //数量
	    			fileList: [],            //文件
	    			remark: '',              //备注
	    			btLoading : false,       //按钮加载状态判断
					message: {
						code : '200',
						msg : '',
					},
	    			isLoading:false,         //页面刷新控制器
				}
			},
			methods:{
	    		//刷新，重新加载当前网页
	    		onRefresh(){
	    			window.location.reload();
	    			this.isLoading = false;
	    		},
	    		//重置组件
	    		resetComponent(){
	    			this.number = 0;
					this.message.code = 200;
					this.message.msg = "",
					this.remark = "";
					this.fileList = [];
					this.btLoading = false;
	    		},
	    		
	    		//校检擦鞋洗鞋数量是否为0
	    		numValidator(val){
	    			if( this.number  == 0 ){
	    				return false;
	    			}
	    			return true;
	    		},
	    		onSubmit() {
					const objApp = this;
					
					//提交按钮显示加载状态，阻止用户再次点击提交按钮
					objApp.btLoading = true;
					
					//验证员工是否登录
		    		isLogin(sessionStorage.getItem("id"));
	    			
		    		//验证错误
					if ( objApp.message.code != 200 ){
						vant.Toast.fail( objApp.message.msg );	
						return ;
					}
					
					//提交表单数据
		    		const params = new FormData();
		    		params.append("nursingID",  objApp.nursingId);
		    		params.append("step",  1);
		    		params.append("remark", objApp.remark);
		    		params.append("number", objApp.number);
		    		//判断是否有图片上传
		    		if (objApp.fileList.length == 0 ){
		    			//默认提交地址及HTTP 请求头
		    			var path = "/PubgoWeb/register/nursingCentel/staff/updateNusingText";
		    			var config = {
		    		       		headers: {
		    		       	        'Content-Type': 'application/x-www-form-urlencoded'
		    		            }
		    		    };
		    		}else{
		    			//遍历图片文件，上传到后台
		    			objApp.fileList.forEach((file, index) => {
		    				params.append("files", file.file);
		    			});
		    			path = "/PubgoWeb/register/nursingCentel/staff/updateNusingFile";
		    			config = {
		    		        	headers: {
		    		        		'Content-Type': 'multipart/form-data'
		    		        	}
		    		    }
		    		}
		    		//提交数据
		    		axios.post(path,params,config)
		    		.then(function(response){
		    			const json = response.data;
		    			if ( json.code == "200" ){
		    				objApp.resetComponent();	
		    				vant.Toast.success('提交成功');
		    				window.location.href='/PubgoWeb/backEnd/customer/NursingCenterManage.html';
		    			}else{
		    				objApp.btLoading = false;
		    				vant.Toast.fail("错误原因: "+json.msg);
		    				 console.error(json.msg);
		    			}
		    		}).catch( error=> {
		    			objApp.btLoading = false;
		    			// 请求发送失败
		    			vant.Toast.fail("请求发送失败");
		    		    console.error(error);
		    		});
	    		},
			},
			mounted(){
				const objApp = this;
				//验证员工是否登录
	    		isLogin(sessionStorage.getItem("id"));
	    		objApp.id = sessionStorage.getItem("id");
	    		objApp.name = sessionStorage.getItem("name");
	    		
	    		//校验员工号登录
	    		isStaffLogin();
				
	    		// 展示加载
		    	vant.Toast.loading({
	    	    	duration: 0, 		
	    	        forbidClick: true,
	    	        message: "加载中..."
	    	    });
	    		
	    		//获取应用列表
	    		axios.get('/PubgoWeb/category/list/quest')
	    			.then(function (response){
	    				const json = response.data;
	    				if( json.code == 200 ){
	    					objApp.categoryList = json.data.categoryVos; 
	    				}else{
	    					vant.Toast.fail("错误原因: "+json.msg);
				   	        console.error("错误代码: "+json.code+"  错误原因: "+json.msg);	
		            	}
	    			})
	    			.catch(function (error) {
	    				// 请求发送失败
				   	  	vant.Toast.fail("请求应用列表失败");
				   	    console.error(error);
	    			});
	    		
	    		//获取数据
	    		objApp.nursingId = getQueryString("id");
	    		
	    		axios.get("/PubgoWeb/register/nursingCentel/queryNursingDetails?nursingID="+objApp.nursingId)
	    		.then(function(response){
	    			const json = response.data;
	    			console.log(json);
	    			if( json.code == 200 ){
	    				//获取数据
	    				objApp.number = json.data.nursingDetailsVo.quantity;
	    				objApp.remark = json.data.nursingDetailsVo.remark;
	    				
	    				vant.Toast.clear();
    				}else{
    					vant.Toast.fail("错误代码: "+json.code+"  错误原因: "+json.msg);
			   	        console.error("错误代码: "+json.code+"  错误原因: "+json.msg);	
	            	}
	    		}).catch(error =>{
	    			// 请求发送失败
			   	  	vant.Toast.fail("请求服务器失败");
			   	    console.error(error);
	    		});
	    		
			}
		});
			
		app.use(vant);
		app.use(vant.Lazyload);
		app.mount('#main-wrapper');
		
		
		
	</script>

</body>
</html>